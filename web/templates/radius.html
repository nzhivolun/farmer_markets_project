{% extends "_base/base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Search Markets by Radius" %}{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h4 class="header-title">{% trans "Search Markets by Radius" %}</h4>
        <p class="text-muted font-13">{% trans "Enter the correct coordinates (latitude -90..90, longitude -180..180)." %}</p>
        <p class="text-muted font-13">{% trans "For example: Latitude 44, Longitude -72, Radius 50 and click 'Search' button" %}</p>
      

        <form method="get" class="row g-2 mb-3">
          <div class="col-md-3">
            <label for="lat" class="form-label">{% trans "Latitude" %}</label>
            <input type="text" id="lat" name="lat" class="form-control" value="{{ lat }}">
          </div>
          <div class="col-md-3">
            <label for="lon" class="form-label">{% trans "Longitude" %}</label>
            <input type="text" id="lon" name="lon" class="form-control" value="{{ lon }}">
          </div>
          <div class="col-md-3">
            <label for="radius" class="form-label">{% trans "Radius (miles)" %}</label>
            <input type="text" id="radius" name="radius" class="form-control" value="{{ radius }}">
          </div>
          <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary">{% trans "Search" %}</button>
          </div>
        </form>

        {% if error %}
          <div class="alert alert-danger">{{ error }}</div>
        {% endif %}

        {% if rows %}
        <p class="text-muted">
          {% trans "Found" %} {{ total }} {% trans "markets" %}. {% trans "Page" %} {{ page }} {% trans "of" %} {{ pages }}.
        </p>

        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th>ID</th>
                <th>{% trans "Name" %}</th>
                <th>{% trans "City" %}</th>
                <th>{% trans "State" %}</th>
                <th>{% trans "ZIP" %}</th>
                <th>{% trans "Distance (miles)" %}</th>
              </tr>
            </thead>
            <tbody>
              {% for r in rows %}
                <tr>
                  <td>{{ r.id }}</td>
                  <td>{{ r.name }}</td>
                  <td>{{ r.city }}</td>
                  <td>{{ r.state }}</td>
                  <td>{{ r.zip }}</td>
                  <td>{{ r.distance_miles|floatformat:2 }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>

          <!-- ПАГИНАЦИЯ -->
            <nav aria-label="Пагинация">
            <ul class="pagination mb-0">
                <!-- В начало -->
                <li class="page-item {% if page == 1 %}disabled{% endif %}">
                    <a class="page-link"
                    href="?lat={{ lat }}&lon={{ lon }}&radius={{ radius }}&per={{ per }}&page=1">{% trans "First" %}</a>
                </li>

                <!-- Назад -->
                <li class="page-item {% if page == 1 %}disabled{% endif %}">
                    <a class="page-link"
                    href="?lat={{ lat }}&lon={{ lon }}&radius={{ radius }}&per={{ per }}&page={{ page|add:'-1' }}">{% trans "Previous" %}</a>
                </li>

                <!-- Номера страниц -->
                {% for i in range_start|default:1|add:'0'|make_list %}
                {% endfor %}
                {% for i in pages|add:'0'|make_list %}
                {% endfor %}
                {% for i in page_window %}
                    <li class="page-item {% if i == page %}active{% endif %}">
                    <a class="page-link"
                        href="?lat={{ lat }}&lon={{ lon }}&radius={{ radius }}&per={{ per }}&page={{ i }}">{{ i }}</a>
                    </li>
                {% endfor %}

                <!-- Вперёд -->
                <li class="page-item {% if page == pages %}disabled{% endif %}">
                    <a class="page-link"
                    href="?lat={{ lat }}&lon={{ lon }}&radius={{ radius }}&per={{ per }}&page={{ page|add:'1' }}">{% trans "Next" %}</a>
                </li>

                <!-- В конец -->
                <li class="page-item {% if page == pages %}disabled{% endif %}">
                    <a class="page-link"
                    href="?lat={{ lat }}&lon={{ lon }}&radius={{ radius }}&per={{ per }}&page={{ pages }}">{% trans "Last" %}</a>
                </li>
            </ul>
            </nav>

        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
